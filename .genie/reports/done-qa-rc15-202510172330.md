# MCP End-to-End QA Report - RC15
**Last Updated:** !`date -u +"%Y-%m-%d %H:%M:%S UTC"`
**Date:** 2025-10-17 23:30 UTC
**Version:** 2.4.0-rc.15
**Test Methodology:** Fresh sessions.json, systematic bug reproduction

---

## Test Results Summary

| Bug | Title | Status | Severity | Notes |
|-----|-------|--------|----------|-------|
| #104 | Background launch timeout | ✅ CONFIRMED | **Medium** | Cosmetic - agent runs successfully |
| #93 | MCP agent start failures | ✅ DUPLICATE of #104 | Medium | Same root cause |
| #89 | CLI output format | ✅ **FIXED** | N/A | No `./genie` references found |
| #102 | Session ID collision | ✅ CONFIRMED | **HIGH** | Causes #90 |
| #66 | Session persistence | ✅ **WORKS** | N/A | Resume successful |
| #90 | full=true truncation | ✅ CONFIRMED | **HIGH** | Caused by #102 |
| #92 | Zombie sessions | ⏳ IN PROGRESS | Medium | Long-running session still active |
| #91 | Missing sessions | ⏳ PENDING | High | Needs fresh reproduction |

---

##

 Detailed Findings

### ✅ Bug #104 - Background Launch Timeout

**Status:** CONFIRMED (Cosmetic UX issue)

**Evidence:**
```
Test 1 - Small prompt:
- MCP output: "Timeout waiting for session ID"
- Reality: Session completed (exitCode: 0, sessionId: 2d5884fd...)
- Duration: ~18s total

Test 2 - Large prompt (~2KB):
- MCP output: "Timeout waiting for session ID"
- Reality: Session running successfully (PIDs alive, log shows active work)
- Duration: 3m 39s+ and counting
```

**Root Cause:**
- 20s timeout in `shared.ts` too short for agent initialization
- Especially slow on WSL2 + large prompts
- Session ID extraction polling times out but work continues

**Impact:** User sees error message but agent runs fine. Confusing UX.

**Recommendation:** Issue already documents progressive timeout solution.

---

### ✅ Bug #93 - MCP Agent Start Failures

**Status:** DUPLICATE of #104

**Evidence:** Same symptoms, same root cause. Large prompts trigger same timeout but work completes.

**Recommendation:** Close as duplicate of #104.

---

### ✅ Bug #89 - CLI Output Format (FIXED!)

**Status:** FIXED in RC15

**Evidence - All MCP outputs checked:**
```
✅ "Use list_sessions to see the session ID"
✅ "Use 'view' to see session transcript or 'resume' to continue"
✅ "No sessions found. Start a new session with the 'run' tool"
❌ NO `./genie` references found anywhere
```

**Fix Applied:** Commit `f034d1d` - display transformation to list_sessions and run outputs

**Recommendation:** Close issue as fixed.

---

### ✅ Bug #102 - Session ID Collision (CRITICAL)

**Status:** CONFIRMED - Root cause of #90

**Evidence:**
```json
// sessions.json BEFORE resume:
"2d5884fd-2fb9-4c50-a50f-83e99f30ca71": {
  "sessionId": "2d5884fd-2fb9-4c50-a50f-83e99f30ca71",
  "logFile": "neurons-analyze-1760743453617.log"
}

// sessions.json AFTER resume:
"temp-neurons/analyze-1760743453617": {  // ← KEY CHANGED!
  "sessionId": "2d5884fd-2fb9-4c50-a50f-83e99f30ca71",  // ← Field unchanged
  "logFile": "neurons-analyze-1760743757130.log"  // ← NEW log file!
}
```

**Impact:**
- ✅ **Functional:** Resume WORKS (agent continues conversation)
- ❌ **Technical:** Session key changes, creates new log file
- ❌ **Side Effect:** Conversation history fragmented (causes Bug #90)

**Recommendation:** HIGH priority - fix session key consistency.

---

### ✅ Bug #90 - Full Transcript Truncation

**Status:** CONFIRMED - Caused by Bug #102

**Evidence:**
```bash
# Session has 3 log files due to #102:
neurons-analyze-1760743453617.log  # 32 lines (original)
neurons-analyze-1760743234193.log  # 20 lines (first resume)
neurons-analyze-1760743757130.log  # 11 lines (second resume)

# But `mcp__genie__view` with full=true shows:
Messages: 1  # ← Only latest log file!
```

**Root Cause:** Session key collision creates new log files. View tool only reads current log file, not complete history.

**Impact:** Conversation continuity lost. Cannot review full session history.

**Recommendation:** Fix #102 first (prevents fragmentation). Then consider log file consolidation.

---

### ✅ Bug #66 - Session Persistence After Resume

**Status:** WORKS in RC15

**Evidence:**
```
1. Started session: 2d5884fd-2fb9-4c50-a50f-83e99f30ca71
2. Session completed
3. Resumed with follow-up question
4. Agent answered correctly with context
```

**Recommendation:** Close as working (note: #102 causes side effects but resume is functional).

---

### ⏳ Bug #92 - Zombie Sessions

**Status:** IN PROGRESS (awaiting long-running session completion)

**Partial Evidence:**
- Found temp-neurons/debug-1760741286841 from previous session
- Status: "running" (created 30+ min ago)
- PIDs: Dead (processes finished)
- Log shows successful completion with result JSON
- sessions.json never updated to "completed"

**Current Test:**
- Large analysis session running for 3m 39s+
- PIDs alive, log shows active file reading
- Status correctly shows "running"
- Will check if status updates to "completed" when done

**Recommendation:** Partial confirmation - need completion test.

---

### ⏳ Bug #91 - Missing Sessions

**Status:** PENDING (need fresh reproduction)

**Previous Evidence:** Sessions from RC8 era are missing (expected - may have been cleaned up).

**Next Steps:** Create new session, complete it, verify it persists in sessions.json.

---

## Key Insights

### 1. **Bug #102 is the root cause of Bug #90**
   - Session key collision creates multiple log files
   - View tool only reads current log, not full history
   - Fix #102 = Fix #90

### 2. **Bug #104/93 are cosmetic, not functional failures**
   - Timeout message misleading but agents work fine
   - Progressive timeout + better messaging needed

### 3. **Default view is intentionally token-efficient**
   - Returns ~50-100 tokens (metadata + truncated lastMessage)
   - `full=true` returns 300-1000+ tokens (complete transcript)
   - NOT a bug - it's optimal design

### 4. **Bug #89 fixed cleanly**
   - Display transformation working correctly
   - All legacy `./genie` references removed

---

## Priority Recommendations

**P0 - Critical:**
1. Fix Bug #102 (session key collision) - solves #90 automatically

**P1 - High:**
2. Verify/fix Bug #92 (zombie session status updates)
3. Reproduce Bug #91 (session persistence) with fresh test

**P2 - Medium:**
4. Improve Bug #104 UX (progressive timeout, better messaging)
5. Close Bug #93 as duplicate of #104
6. Close Bug #89 as fixed
7. Close Bug #66 as working

---

## Test Environment

- OS: Linux (WSL2)
- Node: v22.16.0
- Version: 2.4.0-rc.15
- Method: Fresh sessions.json, systematic reproduction
- Duration: ~30 minutes end-to-end testing

---

**Next Actions:**
1. Wait for large session completion (test #92)
2. Create fresh session and verify persistence (test #91)
3. Update GitHub issues with findings
4. Prioritize #102 fix (unblocks #90)
